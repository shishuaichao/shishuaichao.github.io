<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>ç‹ç³ç‰</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
  <link rel="stylesheet" href="./index.css">
</head>
<body>
  <div id="app">
    
    <h3 class="header">
      <div style="width: 200px">
        å€’è®¡æ—¶ï¼š
        <span>{{format(timer)}}</span>
      </div>
      <div class="score">å¾—åˆ†: {{score}}</div>
    </h3>
    <div class="list_box">
      <div class="list">
        <div class="item" v-for="(item, key) in list" :key="key" :class="{red: item == 1, green: item == 2, blue: item == 3}"></div>
      </div>
      <h3 ref="tips" class="tips animate__animated animate__zoomIn">â¬†ï¸â¬†ï¸é€‰æ‹©åˆ—è¡¨ä¸­æœ€ä¸‹é¢çš„å¤´åƒâ¬†ï¸â¬†ï¸</h3>
      <h1 ref="scoreTipsAdd" class="score_tips add animate__animated">{{scoreAddTips}}</h1>
      <h1 ref="scoreTipsReduce" class="score_tips reduce animate__animated animate__fadeOutUp">{{scoreReduceTips}}</h1>
    </div>
    <div class="setting">
      <button class="btn" @click="pauseHandle">æš‚åœ</button>
      <button class="btn" @click="beginHandle">{{isPause ? 'ç»§ç»­' : 'å¼€å§‹'}}</button>
      <button class="btn" @click="resetHandle">é‡ç½®</button>
      <button class="btn" @click="setTime">è®¾ç½®æ—¶é—´</button>
    </div>
    <div class="result_box_mask" v-if="!timer">
      <div class="result_box">
        <h2>
          <div>ç”¨æ—¶ï¼š<span>{{ time/100 }}s</span></div>
          <div>å¾—åˆ†ï¼š<span>{{ score }}åˆ†</span></div>
        </h2>
        <h1>{{scoreLevel(score, time)}}</h1>
        <div class="btn_box">
          <button @click="beginHandle">é‡æ–°å¼€å§‹</button>
          <button @click="resetHandle">å…³é—­</button>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="item red" @click="handle(1)"></div>
      <div class="item green" @click="handle(2)"></div>
      <div class="item blue" @click="handle(3)"></div>
    </div>
  </div>
</body>
<!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.7.10"></script> -->
<script src="./vue.js"></script>
<script>
  let app = new Vue({
    el: '#app',
    data: {
      isPause: false,  // æš‚åœ
      isBegin: false,
      t: null,
      time: 10000,   // 100s
      timer: 0,
      score: 0,
      list: [],
      scoreAddTips: '',
      scoreReduceTips: '',
    },
    mounted() {
      this.reset()
      this.animateReset()
    },
    methods: {
      format(time) {
        return time/100
      },
      scoreLevel(score, time) {
        // æ¯ç§’ç‚¹å¯¹å‡ ä¸ª
        let level = score/time
        if (level <= 1) {
          return 'çœŸèœğŸ˜‚ğŸ˜‚ğŸ˜‚'
        } else if (level <= 2) {
          return 'ä¸é”™ğŸ˜‹ğŸ˜‹ğŸ˜‹'
        } else {
          return 'ä¼˜ç§€ğŸ˜˜ğŸ˜˜ğŸ˜˜'
        }
      },
      handle(num) {
        if (!this.isBegin || this.isPause) {
          return
        }
        if (this.list[this.list.length - 1] !== num) {
          this.reduceScore()
        } else {
          this.list.pop()
          this.addScore()
        }
        if (!this.list.length && this.timer) {
          this.end()
          setTimeout(() => {
            alert('æ­å–œé€šå…³ï¼ï¼ï¼')
          }, 10);
        }
        this.addAvatar()
      },
      // å‡åˆ†
      reduceScore() {
        this.scoreReduceTips = '-100'
        const el = this.$refs.scoreTipsReduce.classList
        this.scoreShowHide(el)
        this.score -= 100
        if (this.score <= 0) {
          this.score = 0
        }
      },
      // å¾—åˆ†
      addScore() {
        this.scoreAddTips = '+100'
        this.score += 100
        const el = this.$refs.scoreTipsAdd.classList
        this.scoreShowHide(el)
      },
      scoreShowHide(el) {
        el.remove('animate__fadeInUp')
        el.remove('animate__fadeOutUp')
        el.add('animate__fadeInUp')
        setTimeout(() => {
          el.add('animate__fadeOutUp')
        }, 200);
      },
      init() {
        clearInterval(this.t)
        this.t = null
        this.score = 0
        this.timer = this.time
        this.isBegin = false
        this.isPause = false
      },
      timerDown() {
        this.t = setInterval(() => {
          if (this.timer-- <= 0) {
            this.end()
          }
        }, 10);
      },
      beginHandle() {
        if (this.isBegin && !this.isPause) {
          return
        }
        if (this.isPause) {
          // ç»§ç»­
          this.isPause = false
        } else {
          // å¼€å§‹
          this.init()
          this.isBegin = true
        }
        this.timerDown()
      },
      pauseHandle() {
        this.isPause = true
        clearInterval(this.t)
      },
      resetHandle() {
        this.reset()
        this.animateReset()
      },
      addAvatar() {
        if(this.list.length < 10) {
          // æ·»åŠ 10ä¸ª
          for(let i=0; i<10; i++) {
            this.list.unshift(Math.floor(Math.random()*3 + 1))
          }
        }
      },
      reset() {
        this.init()
        this.list = []
        this.addAvatar()
      },
      animateReset() {
        this.$refs.tips.classList.remove('animate__zoomOut')
        this.$refs.tips.classList.add('animate__zoomIn')
        setTimeout(() => {
          this.$refs.tips.classList.remove('animate__zoomIn')
          this.$refs.tips.classList.add('animate__bounce')
        }, 1000);
        setTimeout(() => {
          this.$refs.tips.classList.add('animate__zoomOut')
        }, 3000);
      },
      
      setTime() {
        if (this.isBegin && !this.isPause) {
          alert('æ¸¸æˆè¿‡ç¨‹ä¸­ä¸èƒ½ä¿®æ”¹æ—¶é—´ï¼')
          return
        }
        let num = window.prompt('è®¾ç½®æ—¶é—´ï¼Œå•ä½ç§’ï¼ˆsï¼‰')
        if (parseInt(num) > 0) {
          this.time = parseInt(num) * 100
          this.resetHandle()
        }
      },
      end() {
        this.timer = 0
        this.isBegin = false
        clearInterval(this.t)
      }
    }
  })
</script>
</html>