<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>点点王琳玉</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
  <style>
    body {
      position: fixed;
      /* border: 1px solid #f00; */
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      height: 100vh;
      width: 100vw;
    }
    .footer {
      width: 100%;
      height: 70px;
      display: flex;
      justify-content: space-evenly;
      align-items: center;
      position: absolute;
      bottom: 30px;
      left: 0;
    }
    .item {
      height: 60px;
      width: 60px;
      border-radius: 50%;
      background-size: 100%;
    }
    .red {
      background-image: url(./1.jpg);
    }
    .green {
      background-image: url(./2.jpg);
    }
    .blue{
      background-image: url(./3.jpg);
    }
    #app {

    }
    .list_box {
      position: fixed;
      top: 100px;
      left: calc(50% - 35px);
      height: 400px;
      width: 70px;
      /* border: 1px solid #ccc; */
      overflow: hidden;
    }
    .list {
      position: absolute;
      bottom: 0;
      left: 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .list .item {
      margin-bottom: 10px;
      border: 1px solid #ccc;
    }
    .score {
      text-align: right;
    }
    .setting {
      width: 100%;
      position: fixed;
      bottom: 120px;
      display: flex;
      justify-content: space-evenly;
    }
    .setting button {
      height: 40px;
      width: 80px;
      background-color: pink;
      color: rgb(162, 104, 239);
      outline: none;
      border-color: rgb(162, 104, 239);
    }
    .header {
      display: flex;
      justify-content: space-between;
      padding: 0 40px;
      color: rgb(162, 104, 239);
    }
    .tips {
      position: fixed;
      width: 100%;
      left: 0;
      top: 500px;
      text-align: center;
      color: rgb(162, 104, 239);
    }
    .score_tips {
      position: fixed;
      width: 100%;
      left: 0;
      top: 550px;
      text-align: center;
    }
    .add {
      color: rgb(242, 70, 70);
    }
    .reduce {
      color: rgb(59, 243, 71);
    }
  </style>
</head>
<body>
  <div id="app">
    
    <h3 class="header">
      <div style="width: 200px">
        倒计时：
        <span>{{format(timer)}}</span>
      </div>
      <div class="score">得分: {{score}}</div>
    </h3>
    <div class="list_box">
      <div class="list">
        <div class="item" v-for="(item, key) in list" :key="key" :class="{red: item == 1, green: item == 2, blue: item == 3}"></div>
      </div>
      <h3 ref="tips" class="tips animate__animated animate__zoomIn">⬆︎⬆︎选择列表中最下面的头像⬆︎⬆︎</h3>
      <h1 ref="scoreTipsAdd" class="score_tips add animate__animated" v-show="scoreTips">{{scoreTips}}</h1>
      <h1 ref="scoreTipsReduce" class="score_tips reduce animate__animated animate__fadeOutUp" v-show="scoreTips">{{scoreTips}}</h1>
    </div>
    <div class="setting">
      <button class="btn" @click="pauseHandle">暂停</button>
      <button class="btn" @click="beginHandle">{{isPause ? '继续' : '开始'}}</button>
      <button class="btn" @click="resetHandle">重置</button>
      <button class="btn" @click="setTime">设置时间</button>
    </div>
    <div class="footer">
      <div class="item red" @click="handle(1)"></div>
      <div class="item green" @click="handle(2)"></div>
      <div class="item blue" @click="handle(3)"></div>
    </div>
  </div>
</body>
<!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.7.10"></script> -->
<script src="./vue.js"></script>
<script>
  let app = new Vue({
    el: '#app',
    data: {
      isPause: false,  // 暂停
      isBegin: false,
      t: null,
      time: 10000,   // 100s
      timer: 0,
      score: 0,
      list: [],
      scoreTips: '',
    },
    mounted() {
      this.reset()
    },
    methods: {
      format(num) {
        return num/100
      },
      handle(num) {
        if (!this.isBegin || this.isPause) {
          return
        }
        if (this.list[this.list.length - 1] !== num) {
          this.reduceScore()
        } else {
          this.list.pop()
          this.addScore()
        }
        if (!this.list.length && this.timer) {
          this.end()
          setTimeout(() => {
            alert('恭喜通关！！！')
          }, 10);
        }
        this.addAvatar()
      },
      // 减分
      reduceScore() {
        this.scoreTips = '-100'
        const el = this.$refs.scoreTipsReduce.classList
        this.scoreShowHide(el)
        this.score -= 100
        if (this.score <= 0) {
          this.score = 0
        }
      },
      // 得分
      addScore() {
        this.scoreTips = '+100'
        this.score += 100
        const el = this.$refs.scoreTipsAdd.classList
        this.scoreShowHide(el)
      },
      scoreShowHide(el) {
        el.remove('animate__fadeInUp')
        el.remove('animate__fadeOutUp')
        el.add('animate__fadeInUp')
        setTimeout(() => {
          el.add('animate__fadeOutUp')
        }, 200);
      },
      init() {
        clearInterval(this.t)
        this.t = null
        this.score = 0
        this.timer = this.time
        this.isBegin = false
        this.isPause = false
      },
      timerDown() {
        this.t = setInterval(() => {
          if (this.timer-- <= 0) {
            this.end()
          }
        }, 10);
      },
      beginHandle() {
        if (this.isBegin && !this.isPause) {
          return
        }
        if (this.isPause) {
          this.isPause = false
          this.timerDown()
        } else {
          this.init()
          this.isBegin = true
        }
      },
      pauseHandle() {
        this.isPause = true
        clearInterval(this.t)
      },
      resetHandle() {
        this.reset()
        this.animateReset()
      },
      addAvatar() {
        if(this.list.length < 10) {
          // 添加10个
          for(let i=0; i<10; i++) {
            this.list.unshift(Math.floor(Math.random()*3 + 1))
          }
        }
      },
      reset() {
        this.init()
        this.list = []
        this.addAvatar()
      },
      animateReset() {
        this.$refs.tips.classList.remove('animate__zoomOut')
        this.$refs.tips.classList.add('animate__zoomIn')
        setTimeout(() => {
          this.$refs.tips.classList.remove('animate__zoomIn')
          this.$refs.tips.classList.add('animate__bounce')
        }, 1000);
        setTimeout(() => {
          this.$refs.tips.classList.add('animate__zoomOut')
        }, 5000);
      },
      
      setTime() {
        if (this.isBegin && !this.isPause) {
          alert('游戏过程中不能修改时间！')
          return
        }
        let num = window.prompt('设置时间，单位秒（s）')
        if (parseInt(num) !== NaN) {
          this.time = parseInt(num) * 100
          this.resetHandle()
        }
      },
      end() {
        this.timer = 0
        this.isBegin = false
        clearInterval(this.t)
      }
    }
  })
</script>
</html>